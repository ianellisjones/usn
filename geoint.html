<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IEJ Dashboard - Fleet, DVIDS & Intel</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: #0a0a0f;
            color: #e0e0e0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, #111118 0%, #0a0a0f 100%);
            border-bottom: 1px solid #1e1e2e;
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .header-left { display: flex; align-items: center; gap: 24px; }

        .logo {
            font-size: 18px;
            font-weight: 700;
            color: #00ff88;
            letter-spacing: 1px;
        }

        .logo-sub {
            font-size: 10px;
            font-weight: 500;
            color: #666;
            letter-spacing: 2px;
            margin-top: 2px;
            text-transform: uppercase;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 4px;
            background: rgba(0, 0, 0, 0.3);
            padding: 4px;
            border-radius: 10px;
        }

        .tab-btn {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            font-weight: 600;
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: #666;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab-btn:hover { color: #999; background: rgba(255, 255, 255, 0.05); }

        .tab-btn.active {
            background: linear-gradient(135deg, #00ff88 0%, #00cc6a 100%);
            color: #0a0a0f;
        }

        .timestamp {
            font-size: 11px;
            color: #444;
            font-weight: 500;
        }

        .timestamp span { color: #00ff88; }

        /* Status Bar */
        .status-bar {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .stat { text-align: center; }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #00ffff;
        }

        .stat-value.cvn { color: #ff6b6b; }
        .stat-value.amphib { color: #4ecdc4; }
        .stat-value.news { color: #ffd93d; }

        .stat-label {
            font-size: 9px;
            font-weight: 600;
            color: #555;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-top: 2px;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .tab-content {
            display: none;
            width: 100%;
            height: 100%;
        }

        .tab-content.active {
            display: flex;
        }

        /* Globe Container */
        .globe-container {
            flex: 1;
            background: #0a0a0f;
            position: relative;
        }

        #globe, #dvidsGlobe, #newsGlobe {
            width: 100%;
            height: 100%;
        }

        /* Side Panel */
        .side-panel {
            width: 380px;
            background: #0d0d14;
            border-left: 1px solid #1e1e2e;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-shrink: 0;
        }

        .panel-header {
            padding: 14px 18px;
            border-bottom: 1px solid #1e1e2e;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 11px;
            font-weight: 600;
            color: #00ff88;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* Filter Bar */
        .filter-bar {
            padding: 10px 14px;
            border-bottom: 1px solid #1e1e2e;
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .filter-btn {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            font-weight: 600;
            padding: 5px 12px;
            background: transparent;
            border: 1px solid #2a2a3a;
            color: #666;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.15s;
        }

        .filter-btn:hover { border-color: #444; color: #999; }

        .filter-btn.active {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            color: #00ff88;
        }

        /* List containers */
        .ship-list, .dvids-list, .news-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .ship-list::-webkit-scrollbar,
        .dvids-list::-webkit-scrollbar,
        .news-list::-webkit-scrollbar { width: 5px; }

        .ship-list::-webkit-scrollbar-track,
        .dvids-list::-webkit-scrollbar-track,
        .news-list::-webkit-scrollbar-track { background: #0a0a0f; }

        .ship-list::-webkit-scrollbar-thumb,
        .dvids-list::-webkit-scrollbar-thumb,
        .news-list::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

        .ship-list::-webkit-scrollbar-thumb:hover,
        .dvids-list::-webkit-scrollbar-thumb:hover,
        .news-list::-webkit-scrollbar-thumb:hover { background: #00ff88; }

        /* Location Groups */
        .location-group { margin-bottom: 14px; }

        .location-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: rgba(0, 255, 136, 0.05);
            border-radius: 6px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .location-header:hover { background: rgba(0, 255, 136, 0.1); }

        .location-name {
            flex: 1;
            font-size: 11px;
            font-weight: 600;
            color: #00ff88;
        }

        .location-count {
            font-size: 10px;
            font-weight: 600;
            color: #888;
            background: rgba(255,255,255,0.05);
            padding: 2px 6px;
            border-radius: 8px;
        }

        /* Ship Cards */
        .ship-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid #1e1e2e;
            border-radius: 6px;
            margin-bottom: 5px;
            margin-left: 10px;
            padding: 10px 12px;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .ship-card:hover { border-color: #333; background: rgba(255, 255, 255, 0.04); }
        .ship-card.active { border-color: #00ffff; background: rgba(0, 255, 255, 0.08); }
        .ship-card.cvn { border-left: 3px solid #ff6b6b; }
        .ship-card.amphib { border-left: 3px solid #4ecdc4; }

        .ship-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 3px; }

        .ship-hull { font-size: 13px; font-weight: 700; color: #fff; }
        .ship-hull.cvn { color: #ff6b6b; }
        .ship-hull.amphib { color: #4ecdc4; }

        .ship-type {
            font-size: 8px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.06);
            color: #888;
            letter-spacing: 0.5px;
        }

        .ship-name { font-size: 11px; color: #777; font-weight: 500; }
        .ship-date { font-size: 9px; color: #444; margin-top: 3px; font-weight: 500; }

        /* DVIDS Cards */
        .dvids-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid #1e1e2e;
            border-radius: 6px;
            margin-bottom: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            gap: 10px;
        }

        .dvids-card:hover { border-color: #333; background: rgba(255, 255, 255, 0.04); }
        .dvids-card.active { border-color: #00ffff; background: rgba(0, 255, 255, 0.08); }

        .dvids-card.news { border-left: 3px solid #ff6b6b; }
        .dvids-card.image { border-left: 3px solid #4ecdc4; }
        .dvids-card.video { border-left: 3px solid #ffd93d; }

        .dvids-thumb {
            width: 70px;
            height: 50px;
            border-radius: 4px;
            object-fit: cover;
            flex-shrink: 0;
            background: #1a1a2e;
        }

        .dvids-content { flex: 1; min-width: 0; }

        .dvids-title {
            font-size: 11px;
            font-weight: 600;
            color: #e0e0e0;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .dvids-meta {
            display: flex;
            gap: 8px;
            margin-top: 4px;
            flex-wrap: wrap;
        }

        .dvids-badge {
            font-size: 8px;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: uppercase;
        }

        .dvids-badge.news { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
        .dvids-badge.image { background: rgba(78, 205, 196, 0.2); color: #4ecdc4; }
        .dvids-badge.video { background: rgba(255, 217, 61, 0.2); color: #ffd93d; }
        .dvids-badge.branch { background: rgba(255, 255, 255, 0.1); color: #888; }

        .dvids-date { font-size: 9px; color: #555; margin-top: 4px; }

        /* News Cards (IEJ Style) */
        .news-section { margin-bottom: 16px; }

        .news-section-header {
            font-size: 10px;
            font-weight: 600;
            color: #58a6ff;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            padding: 8px 10px;
            background: rgba(88, 166, 255, 0.05);
            border-radius: 4px;
            margin-bottom: 8px;
        }

        .news-item {
            padding: 8px 10px;
            border-bottom: 1px solid #1e1e2e;
            cursor: pointer;
            transition: background 0.15s;
        }

        .news-item:hover { background: rgba(255, 255, 255, 0.02); }
        .news-item:last-child { border-bottom: none; }

        .news-item.breaking .news-headline { color: #f85149; font-weight: 600; }
        .news-item.high .news-headline { color: #d29922; }

        .news-headline {
            font-size: 12px;
            color: #c9d1d9;
            line-height: 1.4;
        }

        .news-source {
            font-size: 9px;
            color: #6e7681;
            text-transform: uppercase;
            margin-top: 4px;
            letter-spacing: 0.5px;
        }

        /* Detail Panel */
        .detail-panel {
            background: #111118;
            border-top: 1px solid #1e1e2e;
            padding: 14px;
            max-height: 260px;
            overflow-y: auto;
        }

        .detail-panel.hidden { display: none; }

        .detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .detail-title { font-size: 14px; font-weight: 700; color: #00ffff; }

        .detail-close {
            cursor: pointer;
            color: #555;
            font-size: 16px;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.15s;
        }

        .detail-close:hover { color: #ff6b6b; background: rgba(255, 107, 107, 0.1); }

        .detail-row { display: flex; margin-bottom: 6px; }
        .detail-label { width: 65px; font-size: 9px; font-weight: 600; color: #444; text-transform: uppercase; letter-spacing: 0.5px; }
        .detail-value { flex: 1; font-size: 12px; color: #aaa; font-weight: 500; }

        .detail-status {
            font-size: 11px;
            color: #00ff88;
            line-height: 1.5;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            margin-top: 10px;
            font-weight: 500;
        }

        .detail-link {
            display: inline-block;
            margin-top: 10px;
            font-size: 11px;
            color: #58a6ff;
            text-decoration: none;
            padding: 6px 12px;
            background: rgba(88, 166, 255, 0.1);
            border-radius: 4px;
            transition: all 0.15s;
        }

        .detail-link:hover { background: rgba(88, 166, 255, 0.2); }

        /* Attribution */
        .attribution {
            padding: 8px 14px;
            border-top: 1px solid #1e1e2e;
            font-size: 9px;
            color: #444;
            text-align: center;
            font-weight: 500;
            flex-shrink: 0;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.visible { opacity: 1; visibility: visible; }

        .modal {
            background: #111118;
            border: 1px solid #2a2a3a;
            border-radius: 12px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-overlay.visible .modal { transform: scale(1); }

        .modal-header {
            padding: 18px 20px;
            border-bottom: 1px solid #1e1e2e;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(180deg, #1a1a22 0%, #111118 100%);
        }

        .modal-title { font-size: 16px; font-weight: 700; color: #ff6b6b; letter-spacing: 1px; }
        .modal-subtitle { font-size: 10px; color: #666; margin-top: 3px; font-weight: 500; }

        .modal-close {
            cursor: pointer;
            color: #555;
            font-size: 22px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.15s;
        }

        .modal-close:hover { color: #ff6b6b; background: rgba(255, 107, 107, 0.1); }

        .modal-body { padding: 14px 20px 20px; overflow-y: auto; max-height: calc(85vh - 80px); }

        .carrier-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }

        .carrier-item {
            background: rgba(255, 107, 107, 0.05);
            border: 1px solid rgba(255, 107, 107, 0.2);
            border-radius: 8px;
            padding: 12px 14px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .carrier-item:hover {
            background: rgba(255, 107, 107, 0.1);
            border-color: rgba(255, 107, 107, 0.4);
            transform: translateY(-2px);
        }

        .carrier-hull { font-size: 14px; font-weight: 700; color: #ff6b6b; margin-bottom: 3px; }
        .carrier-name { font-size: 11px; color: #888; font-weight: 500; margin-bottom: 6px; }
        .carrier-location {
            font-size: 10px;
            color: #00ff88;
            font-weight: 600;
            padding: 3px 8px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 3px;
            display: inline-block;
        }

        /* Carrier Button */
        .carrier-btn {
            font-family: 'Inter', sans-serif;
            font-size: 11px;
            font-weight: 600;
            padding: 8px 16px;
            background: linear-gradient(135deg, #ff6b6b 0%, #cc4444 100%);
            border: none;
            color: #fff;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
            letter-spacing: 0.5px;
        }

        .carrier-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4); }

        /* Toggle Button */
        .toggle-container { display: flex; gap: 4px; }

        .toggle-btn {
            font-family: 'Inter', sans-serif;
            font-size: 10px;
            font-weight: 600;
            padding: 5px 12px;
            background: transparent;
            border: 1px solid #2a2a3a;
            color: #666;
            cursor: pointer;
            transition: all 0.15s;
        }

        .toggle-btn:first-child { border-radius: 5px 0 0 5px; }
        .toggle-btn:last-child { border-radius: 0 5px 5px 0; }

        .toggle-btn.active {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            color: #00ff88;
        }

        /* Search Box */
        .search-box {
            padding: 10px 14px;
            border-bottom: 1px solid #1e1e2e;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #2a2a3a;
            border-radius: 6px;
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            font-size: 11px;
        }

        .search-input:focus { outline: none; border-color: #00ff88; }
        .search-input::placeholder { color: #555; }

        /* Hover Popup for Map */
        .map-popup {
            position: absolute;
            background: #111118;
            border: 1px solid #2a2a3a;
            border-radius: 8px;
            padding: 12px;
            max-width: 300px;
            z-index: 100;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .map-popup.visible { opacity: 1; }

        .map-popup-title {
            font-size: 12px;
            font-weight: 600;
            color: #00ff88;
            margin-bottom: 6px;
        }

        .map-popup-count {
            font-size: 10px;
            color: #888;
            margin-bottom: 8px;
        }

        .map-popup-items {
            max-height: 150px;
            overflow-y: auto;
        }

        .map-popup-item {
            font-size: 10px;
            color: #aaa;
            padding: 4px 0;
            border-bottom: 1px solid #1e1e2e;
        }

        .map-popup-item:last-child { border-bottom: none; }

        .map-popup-item .item-type {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .map-popup-item .item-type.news { background: #ff6b6b; }
        .map-popup-item .item-type.image { background: #4ecdc4; }
        .map-popup-item .item-type.video { background: #ffd93d; }

        /* Time Period Indicator */
        .time-indicator {
            font-size: 10px;
            color: #666;
            padding: 4px 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .time-indicator.daily { color: #ffd93d; }
        .time-indicator.weekly { color: #4ecdc4; }

        /* DVIDS Card Grid Layout */
        .dvids-dashboard {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #0a0a0f;
        }

        .dvids-toolbar {
            display: flex;
            gap: 12px;
            padding: 14px 20px;
            border-bottom: 1px solid #1e1e2e;
            align-items: center;
            flex-wrap: wrap;
            background: #0d0d14;
        }

        .dvids-toolbar .panel-title {
            margin-right: auto;
        }

        .dvids-stats {
            display: flex;
            gap: 20px;
            padding: 10px 20px;
            border-bottom: 1px solid #1e1e2e;
            background: rgba(0, 0, 0, 0.3);
        }

        .dvids-stat {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dvids-stat-value {
            font-size: 18px;
            font-weight: 700;
        }

        .dvids-stat-value.news { color: #ff6b6b; }
        .dvids-stat-value.image { color: #4ecdc4; }
        .dvids-stat-value.video { color: #ffd93d; }
        .dvids-stat-value.total { color: #00ff88; }

        .dvids-stat-label {
            font-size: 10px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dvids-grid-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .dvids-grid-container::-webkit-scrollbar { width: 6px; }
        .dvids-grid-container::-webkit-scrollbar-track { background: #0a0a0f; }
        .dvids-grid-container::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        .dvids-grid-container::-webkit-scrollbar-thumb:hover { background: #00ff88; }

        .dvids-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        .dvids-grid-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid #1e1e2e;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .dvids-grid-card:hover {
            border-color: #333;
            background: rgba(255, 255, 255, 0.04);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .dvids-grid-card.news { border-top: 3px solid #ff6b6b; }
        .dvids-grid-card.image { border-top: 3px solid #4ecdc4; }
        .dvids-grid-card.video { border-top: 3px solid #ffd93d; }

        .dvids-grid-thumb {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: #1a1a2e;
        }

        .dvids-grid-body {
            padding: 14px;
        }

        .dvids-grid-badges {
            display: flex;
            gap: 6px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .dvids-grid-badge {
            font-size: 9px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dvids-grid-badge.news { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }
        .dvids-grid-badge.image { background: rgba(78, 205, 196, 0.2); color: #4ecdc4; }
        .dvids-grid-badge.video { background: rgba(255, 217, 61, 0.2); color: #ffd93d; }
        .dvids-grid-badge.branch { background: rgba(255, 255, 255, 0.1); color: #888; }
        .dvids-grid-badge.location { background: rgba(0, 255, 136, 0.1); color: #00ff88; }

        .dvids-grid-title {
            font-size: 14px;
            font-weight: 600;
            color: #e0e0e0;
            line-height: 1.4;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .dvids-grid-desc {
            font-size: 12px;
            color: #777;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .dvids-grid-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid #1e1e2e;
        }

        .dvids-grid-unit {
            font-size: 10px;
            color: #666;
            max-width: 60%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .dvids-grid-date {
            font-size: 10px;
            color: #555;
        }

        .dvids-empty {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: #555;
        }

        .dvids-empty-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .dvids-empty-title {
            font-size: 16px;
            color: #666;
            margin-bottom: 8px;
        }

        .dvids-empty-text {
            font-size: 12px;
            color: #555;
        }

        .dvids-footer {
            padding: 10px 20px;
            border-top: 1px solid #1e1e2e;
            text-align: center;
            font-size: 10px;
            color: #444;
            background: #0d0d14;
        }

        .dvids-footer .timestamp {
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <header class="header">
            <div class="header-left">
                <div>
                    <div class="logo">IEJ DASHBOARD</div>
                    <div class="logo-sub">Fleet Tracking | DVIDS Intel | Breaking News</div>
                </div>
                <nav class="tab-nav">
                    <button class="tab-btn active" data-tab="fleet">Fleet Tracker</button>
                    <button class="tab-btn" data-tab="dvids">DVIDS Aggregator</button>
                    <button class="tab-btn" data-tab="news">Breaking News</button>
                </nav>
            </div>
            <div class="status-bar" id="statusBar">
                <div class="stat">
                    <div class="stat-value">20</div>
                    <div class="stat-label">Ships</div>
                </div>
                <div class="stat">
                    <div class="stat-value cvn">11</div>
                    <div class="stat-label">Carriers</div>
                </div>
                <div class="stat">
                    <div class="stat-value amphib">9</div>
                    <div class="stat-label">Amphibs</div>
                </div>
            </div>
            <button class="carrier-btn" onclick="showCarrierModal()" id="carrierBtn">Where are the carriers?</button>
        </header>

        <!-- Fleet Tracker Tab -->
        <div class="content-area">
            <div class="tab-content active" data-tab="fleet">
                <div class="globe-container">
                    <div id="globe"></div>
                </div>
                <div class="side-panel">
                    <div class="panel-header">
                        <div class="panel-title">Fleet Status</div>
                    </div>
                    <div class="filter-bar" id="fleetFilters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="CVN">CVN</button>
                        <button class="filter-btn" data-filter="LHA">LHA</button>
                        <button class="filter-btn" data-filter="LHD">LHD</button>
                    </div>
                    <div class="ship-list" id="shipList"></div>
                    <div class="detail-panel hidden" id="fleetDetailPanel">
                        <div class="detail-header">
                            <div class="detail-title" id="fleetDetailTitle">-</div>
                            <span class="detail-close" onclick="closeFleetDetail()">&#x2715;</span>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Class</div>
                            <div class="detail-value" id="fleetDetailClass">-</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Location</div>
                            <div class="detail-value" id="fleetDetailLocation">-</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">Region</div>
                            <div class="detail-value" id="fleetDetailRegion">-</div>
                        </div>
                        <div class="detail-row">
                            <div class="detail-label">As Of</div>
                            <div class="detail-value" id="fleetDetailDate">-</div>
                        </div>
                        <div class="detail-status" id="fleetDetailStatus">-</div>
                    </div>
                    <div class="attribution">
                        <div>Created by @ianellisjones and IEJ Media</div>
                        <div class="timestamp">Last Update: <span id="lastUpdateFleet">-</span></div>
                    </div>
                </div>
            </div>

            <!-- DVIDS Aggregator Tab -->
            <div class="tab-content" data-tab="dvids">
                <div class="dvids-dashboard">
                    <div class="dvids-toolbar">
                        <div class="panel-title">DVIDS CONTENT</div>
                        <input type="text" class="search-input" id="dvidsSearch" placeholder="Search articles, units, keywords..." style="max-width: 300px;">
                        <div class="filter-bar" id="dvidsFilters" style="border: none; padding: 0;">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="news">News</button>
                            <button class="filter-btn" data-filter="image">Images</button>
                            <button class="filter-btn" data-filter="video">Videos</button>
                        </div>
                        <div class="toggle-container">
                            <button class="toggle-btn active" data-period="daily">24h</button>
                            <button class="toggle-btn" data-period="weekly">7 Days</button>
                        </div>
                    </div>
                    <div class="dvids-stats" id="dvidsStats">
                        <div class="dvids-stat">
                            <span class="dvids-stat-value total" id="dvidsTotalCount">0</span>
                            <span class="dvids-stat-label">Total</span>
                        </div>
                        <div class="dvids-stat">
                            <span class="dvids-stat-value news" id="dvidsNewsCount">0</span>
                            <span class="dvids-stat-label">News</span>
                        </div>
                        <div class="dvids-stat">
                            <span class="dvids-stat-value image" id="dvidsImageCount">0</span>
                            <span class="dvids-stat-label">Images</span>
                        </div>
                        <div class="dvids-stat">
                            <span class="dvids-stat-value video" id="dvidsVideoCount">0</span>
                            <span class="dvids-stat-label">Videos</span>
                        </div>
                    </div>
                    <div class="dvids-grid-container">
                        <div class="dvids-grid" id="dvidsGrid"></div>
                    </div>
                    <div class="dvids-footer">
                        <div>Data from DVIDS | Created by @ianellisjones and IEJ Media</div>
                        <div class="timestamp">Last Update: <span id="lastUpdateDvids">-</span></div>
                    </div>
                </div>
            </div>

            <!-- Breaking News Tab -->
            <div class="tab-content" data-tab="news">
                <div class="globe-container">
                    <div id="newsGlobe"></div>
                </div>
                <div class="side-panel">
                    <div class="panel-header">
                        <div class="panel-title">Intel Brief</div>
                        <span class="time-indicator" id="newsTimeIndicator">Live</span>
                    </div>
                    <div class="filter-bar" id="newsFilters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="breaking">Breaking</button>
                        <button class="filter-btn" data-filter="globe">Globe</button>
                        <button class="filter-btn" data-filter="us">US</button>
                        <button class="filter-btn" data-filter="asia">Asia</button>
                        <button class="filter-btn" data-filter="europe">Europe</button>
                        <button class="filter-btn" data-filter="mideast">Mid East</button>
                    </div>
                    <div class="news-list" id="newsList"></div>
                    <div class="attribution">
                        <div>AI-Aggregated Intel | Created by IEJ Media</div>
                        <div class="timestamp">Last Update: <span id="lastUpdateNews">-</span></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Carrier Modal -->
    <div class="modal-overlay" id="carrierModal" onclick="closeCarrierModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div>
                    <div class="modal-title">WHERE ARE THE CARRIERS?</div>
                    <div class="modal-subtitle">Current positions of all 11 U.S. Navy aircraft carriers</div>
                </div>
                <span class="modal-close" onclick="closeCarrierModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="carrier-grid" id="carrierGrid"></div>
            </div>
        </div>
    </div>

    <script>
        // ============================================================================
        // DATA - Will be populated by scrapers
        // ============================================================================

        // Fleet data (populated by fleet scraper)
        const shipsData = [{"hull": "CVN68", "name": "USS Nimitz", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Bremerton / Kitsap", "lat": 47.5673, "lon": -122.6329, "region": "CONUS", "date": "2025", "status": ", USS Nimitz  moored at Delta Pier on Naval Base Kitsap-Bremerton following an extended nine-month deployment in the U.S. 5th and 7th Fleet AoR.", "source_url": "http://uscarriers.net/cvn68history.htm", "display_lat": 47.5673, "display_lon": -119.6329}, {"hull": "CVN69", "name": "USS Dwight D. Eisenhower", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "Jan. 8", "status": "September 26, USS Dwight D. Eisenhower moored at Pier 12N on Naval Station Norfolk after a six-day underway for TRACOM-CQ, in the Jacksonville Op. Area; Moved \"dead-stick\" to Super Pier 5N in Norfolk Naval Shipyard, for a Planned Incremental Availability (PIA), on Jan. 8.", "source_url": "http://uscarriers.net/cvn69history.htm", "display_lat": 36.9473, "display_lon": -71.3134}, {"hull": "CVN70", "name": "USS Carl Vinson", "ship_class": "Nimitz", "ship_type": "CVN", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "September 16", "status": "September 16, The Carl Vinson moored at Juliet Pier on Naval Air Station North Island after a three-day underway for ammo offload.", "source_url": "http://uscarriers.net/cvn70history.htm", "display_lat": 32.7157, "display_lon": -112.1611}, {"hull": "CVN71", "name": "USS Theodore Roosevelt", "ship_class": "Nimitz", "ship_type": "CVN", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "Feb. 2", "status": "January 15, 2026  USS Theodore Roosevelt moored at Berth Lima on Naval Air Station North Island after a one-day underway in the SOCAL Op. Area; Underway for FRS-CQ from Jan. 21-28; Underway again on Jan. 30; Moored at Ammunition Pier, Naval Magazine Indian Island in Port Hadlock, Wash., for ammo onload from Feb. 2-5.", "source_url": "http://uscarriers.net/cvn71history.htm", "display_lat": 37.69534607176052, "display_lon": -114.2861}, {"hull": "CVN72", "name": "USS Abraham Lincoln", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Arabian Sea", "lat": 15.0, "lon": 65.0, "region": "CENTCOM", "date": "Jan. 27", "status": "January 26, USS Abraham Lincoln CSG recently arrived on station in the North Arabian Sea, off the east coast of Oman; Conducted a replenishment-at-sea with the USNS Carl Brashear (T-AKE 7) on Jan. 27.", "source_url": "http://uscarriers.net/cvn72history.htm", "display_lat": 15.0, "display_lon": 65.0}, {"hull": "CVN73", "name": "USS George Washington", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Yokosuka", "lat": 35.2831, "lon": 139.6703, "region": "WESTPAC", "date": "2025", "status": ", USS George Washington moored at Berth 12 on Fleet Activities Yokosuka following a two-month patrol.", "source_url": "http://uscarriers.net/cvn73history.htm", "display_lat": 35.2831, "display_lon": 139.6703}, {"hull": "CVN74", "name": "USS John C. Stennis", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Newport News", "lat": 36.9788, "lon": -76.428, "region": "CONUS", "date": "April 8", "status": "April 8, 2024 USS John C. Stennis undocked and moored at Outfitting Berth #1 on Newport News Shipyard.", "source_url": "http://uscarriers.net/cvn74history.htm", "display_lat": 36.9788, "display_lon": -76.428}, {"hull": "CVN75", "name": "USS Harry S. Truman", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "Jan. 21", "status": "September 26, The Harry S. Truman moored at Pier 14S on Naval Station Norfolk; Moved to Pier 14N on Sept. 28; Brief underway  on Oct. 8; Moved to Pier 12N on Jan. 21, 2026.", "source_url": "http://uscarriers.net/cvn75history.htm", "display_lat": 41.92694607176052, "display_lon": -73.4384}, {"hull": "CVN76", "name": "USS Ronald Reagan", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Bremerton / Kitsap", "lat": 47.5673, "lon": -122.6329, "region": "CONUS", "date": "Dec. 2", "status": "November 12,  USS Ronald Reagan moored at Bravo Pier on Naval Base Kitsap-Bremerton; Underway for FRS-CQ, in the SOCAL Op. Area, from Dec. 2-13.", "source_url": "http://uscarriers.net/cvn76history.htm", "display_lat": 47.5673, "display_lon": -126.08290000000001}, {"hull": "CVN77", "name": "USS George H.W. Bush", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "Feb. 3", "status": "January 27, 2026 USS George H.W. Bush moored at Pier 14S on Naval Station Norfolk after a two-week underway for FRS-CQ, in the Virginia Capes and Key West Op. Areas; Underway for  Composite Training Unit Exercise (COMPTUEX) on Feb. 3.", "source_url": "http://uscarriers.net/cvn77history.htm", "display_lat": 41.27742701892219, "display_lon": -78.8134}, {"hull": "CVN78", "name": "USS Gerald R. Ford", "ship_class": "Ford", "ship_type": "CVN", "location": "Caribbean Sea", "lat": 15.5, "lon": -73.0, "region": "SOUTHCOM", "date": "February 8", "status": "February 8, The Gerald R. Ford recently arrived  off the south coast of Puerto Rico.", "source_url": "http://uscarriers.net/cvn78history.htm", "display_lat": 15.5, "display_lon": -73.0}, {"hull": "LHD1", "name": "USS Wasp", "ship_class": "Wasp", "ship_type": "LHD", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "May 19", "status": "April 14, USS Wasp moored at Berth 6, Pier 11 on Naval Station Norfolk after a 10-day underway for deck landing qualifications, in the Virginia Capes Op. Area; Underway again on April 28; Moored at Berth 6, Pier 6 on May 9; Moved \"dead-stick\" to Pier 1 in BAE Systems shipyard on May 19.", "source_url": "http://uscarriers.net/lhd1history.htm", "display_lat": 36.9473, "display_lon": -82.0634}, {"hull": "LHD2", "name": "USS Essex", "ship_class": "Wasp", "ship_type": "LHD", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "Feb. 3", "status": "January 24, 2026 USS Essex moored at Berth 5, Pier 2 on Naval Base San Diego after a two-day underway in the SOCAL Op. Area; Underway again on Feb. 3.", "source_url": "http://uscarriers.net/lhd2history.htm", "display_lat": 37.04582701892219, "display_lon": -119.6611}, {"hull": "LHD3", "name": "USS Kearsarge", "ship_class": "Wasp", "ship_type": "LHD", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "December 12", "status": "December 12, The Kearsarge moored at Berth 1, Pier 10 on Naval Station Norfolk.", "source_url": "http://uscarriers.net/lhd3history.htm", "display_lat": 32.61717298107781, "display_lon": -78.8134}, {"hull": "LHD4", "name": "USS Boxer", "ship_class": "Wasp", "ship_type": "LHD", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "February 6", "status": "February 6, 2026  USS Boxer moored at Berth 6, Pier 13 on Naval Base San Diego after a 16-day underway for ARG/MEUEX.", "source_url": "http://uscarriers.net/lhd4history.htm", "display_lat": 32.7157, "display_lon": -122.9111}, {"hull": "LHD5", "name": "USS Bataan", "ship_class": "Wasp", "ship_type": "LHD", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "2025", "status": "July ?, 2025 USS Bataan undocked and moored at  Berth 2E on NASSCO shipyard.", "source_url": "http://uscarriers.net/lhd5history.htm", "display_lat": 31.96765392823948, "display_lon": -73.4384}, {"hull": "LHD7", "name": "USS Iwo Jima", "ship_class": "Wasp", "ship_type": "LHD", "location": "Ponce", "lat": 17.98, "lon": -66.6141, "region": "SOUTHCOM", "date": "Jan. 15", "status": "January 2, 2026 The Iwo Jima ARG recently arrived northeast of Orchila Island, Venezuela, in support of Operation Absolute Resolve; Moored at Wharf C2 on Naval Station Mayport from Jan. 7-11; Moored at Berth 4/5 in Port of Ponce from Jan. 15-20.", "source_url": "http://uscarriers.net/lhd7history.htm", "display_lat": 17.98, "display_lon": -66.6141}, {"hull": "LHD8", "name": "USS Makin Island", "ship_class": "Wasp", "ship_type": "LHD", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "Feb. 4", "status": "January 21, USS Makin Island departed Naval Base San Diego for a Quarterly Underway Amphibious Readiness Training 26.2; Anchored off Camp Pendleton from Jan. 23-24; Moored at Berth 5, Pier 8 on Jan. 30; Underway again from Feb. 4-5.", "source_url": "http://uscarriers.net/lhd8history.htm", "display_lat": 28.385572981077807, "display_lon": -119.6611}, {"hull": "LHA6", "name": "USS America", "ship_class": "America", "ship_type": "LHA", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "2027", "status": ", USS America moored at Berth 5, Pier 13 in its new homeport of Naval Base San Diego after forward-deployed to Japan for nearly six years.", "source_url": "http://uscarriers.net/lha6history.htm", "display_lat": 27.73605392823948, "display_lon": -114.2861}, {"hull": "LHA7", "name": "USS Tripoli", "ship_class": "America", "ship_type": "LHA", "location": "Okinawa", "lat": 26.3344, "lon": 127.8056, "region": "WESTPAC", "date": "Feb. 8", "status": "The Tripoli  moored at Navy Pier East on White Beach Naval Facility for a two-day port call; Moored at Navy Pier East again on Feb. 8.", "source_url": "http://uscarriers.net/lha7history.htm", "display_lat": 26.3344, "display_lon": 127.8056}];

        // DVIDS data (will be loaded from dvids_data.json)
        let dvidsData = { items: [], total_count: 0, by_type: {}, by_branch: {}, by_country: {} };

        // News data (populated by news aggregator)
        let newsData = {
            categories: {
                globe: [],
                us: [],
                europe: [],
                asia: [],
                mideast: [],
                conflicts: [],
                cyber: [],
                finance: []
            }
        };

        // Location coordinates for DVIDS mapping
        const locationCoords = {
            "United States": { lat: 39.8283, lon: -98.5795 },
            "Japan": { lat: 36.2048, lon: 138.2529 },
            "South Korea": { lat: 35.9078, lon: 127.7669 },
            "Germany": { lat: 51.1657, lon: 10.4515 },
            "Italy": { lat: 41.8719, lon: 12.5674 },
            "Spain": { lat: 40.4637, lon: -3.7492 },
            "Bahrain": { lat: 26.0667, lon: 50.5577 },
            "Guam": { lat: 13.4443, lon: 144.7937 },
            "Pacific Ocean": { lat: 0, lon: -160 },
            "Atlantic Ocean": { lat: 25, lon: -40 },
            "Arabian Sea": { lat: 15, lon: 65 },
            "South China Sea": { lat: 12, lon: 115 },
            "Mediterranean Sea": { lat: 35, lon: 18 },
            "At Sea": { lat: 20, lon: -60 },
            "Singapore": { lat: 1.3521, lon: 103.8198 },
            "Philippines": { lat: 12.8797, lon: 121.7740 },
            "Australia": { lat: -25.2744, lon: 133.7751 },
            "United Kingdom": { lat: 55.3781, lon: -3.4360 },
            "Poland": { lat: 51.9194, lon: 19.1451 },
            "Romania": { lat: 45.9432, lon: 24.9668 },
            "Tunisia": { lat: 33.8869, lon: 9.5375 },
            "Kenya": { lat: -0.0236, lon: 37.9062 },
            "Ethiopia": { lat: 9.1450, lon: 40.4897 },
            "Antarctica": { lat: -82.8628, lon: 135.0 },
            "British Indian Ocean Territory": { lat: -6.3432, lon: 71.8765 },
            "Slovakia": { lat: 48.6690, lon: 19.6990 },
            "Cambodia": { lat: 12.5657, lon: 104.9910 }
        };

        // ============================================================================
        // STATE
        // ============================================================================

        let activeTab = 'fleet';
        let fleetFilter = 'all';
        let dvidsFilter = 'all';
        let newsFilter = 'all';
        let dvidsPeriod = 'daily';
        let selectedFleetShip = null;
        let selectedDvidsItem = null;
        let dvidsSearch = '';

        // ============================================================================
        // INITIALIZATION
        // ============================================================================

        document.addEventListener('DOMContentLoaded', function() {
            initTabs();
            initFleetTracker();
            loadDvidsData();
            loadNewsData();
            updateTimestamp();
        });

        function updateTimestamp() {
            const now = new Date();
            const ts = now.toISOString().slice(0, 16).replace('T', ' ') + ' UTC';
            ['lastUpdateFleet', 'lastUpdateDvids', 'lastUpdateNews'].forEach(id => {
                const el = document.getElementById(id);
                if (el) el.textContent = ts;
            });
        }

        // ============================================================================
        // TAB NAVIGATION
        // ============================================================================

        function initTabs() {
            const tabBtns = document.querySelectorAll('.tab-btn');
            tabBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.dataset.tab;
                    switchTab(tab);
                });
            });
        }

        function switchTab(tab) {
            activeTab = tab;

            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.tab === tab);
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.dataset.tab === tab);
            });

            // Update status bar based on tab
            updateStatusBar(tab);

            // Update carrier button visibility
            document.getElementById('carrierBtn').style.display = tab === 'fleet' ? 'block' : 'none';

            // Initialize globe for the news tab if needed
            if (tab === 'news') {
                initNewsGlobe();
            }
        }

        function updateStatusBar(tab) {
            const statusBar = document.getElementById('statusBar');
            if (tab === 'fleet') {
                const cvnCount = shipsData.filter(s => s.ship_type === 'CVN').length;
                const amphibCount = shipsData.filter(s => s.ship_type !== 'CVN').length;
                statusBar.innerHTML = `
                    <div class="stat"><div class="stat-value">${shipsData.length}</div><div class="stat-label">Ships</div></div>
                    <div class="stat"><div class="stat-value cvn">${cvnCount}</div><div class="stat-label">Carriers</div></div>
                    <div class="stat"><div class="stat-value amphib">${amphibCount}</div><div class="stat-label">Amphibs</div></div>
                `;
            } else if (tab === 'dvids') {
                const types = dvidsData.by_type || {};
                statusBar.innerHTML = `
                    <div class="stat"><div class="stat-value">${dvidsData.total_count || 0}</div><div class="stat-label">Items</div></div>
                    <div class="stat"><div class="stat-value cvn">${types.news || 0}</div><div class="stat-label">News</div></div>
                    <div class="stat"><div class="stat-value amphib">${types.image || 0}</div><div class="stat-label">Images</div></div>
                    <div class="stat"><div class="stat-value news">${types.video || 0}</div><div class="stat-label">Videos</div></div>
                `;
            } else if (tab === 'news') {
                const totalNews = Object.values(newsData.categories).flat().length;
                statusBar.innerHTML = `
                    <div class="stat"><div class="stat-value">${totalNews}</div><div class="stat-label">Headlines</div></div>
                    <div class="stat"><div class="stat-value cvn">${newsData.categories.globe?.length || 0}</div><div class="stat-label">Global</div></div>
                    <div class="stat"><div class="stat-value amphib">${newsData.categories.us?.length || 0}</div><div class="stat-label">US</div></div>
                `;
            }
        }

        // ============================================================================
        // FLEET TRACKER
        // ============================================================================

        function initFleetTracker() {
            initFleetGlobe();
            renderFleetList();
            initFleetFilters();
        }

        function initFleetGlobe() {
            const cvnShips = shipsData.filter(s => s.ship_type === 'CVN');
            const amphibShips = shipsData.filter(s => s.ship_type !== 'CVN');

            const cvnTrace = {
                type: 'scattergeo', mode: 'markers+text',
                lat: cvnShips.map(s => s.display_lat), lon: cvnShips.map(s => s.display_lon),
                text: cvnShips.map(s => s.hull), textposition: 'top center',
                textfont: { family: 'Inter, sans-serif', size: 10, color: '#ff6b6b', weight: 600 },
                hoverinfo: 'text', hovertext: cvnShips.map(s => `<b>${s.hull}</b><br>${s.name}<br>${s.location}`),
                marker: { size: 12, color: '#ff6b6b', symbol: 'diamond', line: { width: 2, color: '#cc4444' } },
                name: 'Carriers (CVN)', customdata: cvnShips
            };

            const amphibTrace = {
                type: 'scattergeo', mode: 'markers+text',
                lat: amphibShips.map(s => s.display_lat), lon: amphibShips.map(s => s.display_lon),
                text: amphibShips.map(s => s.hull), textposition: 'top center',
                textfont: { family: 'Inter, sans-serif', size: 9, color: '#4ecdc4', weight: 600 },
                hoverinfo: 'text', hovertext: amphibShips.map(s => `<b>${s.hull}</b><br>${s.name}<br>${s.location}`),
                marker: { size: 10, color: '#4ecdc4', symbol: 'circle', line: { width: 2, color: '#2a9d8f' } },
                name: 'Amphibs (LHA/LHD)', customdata: amphibShips
            };

            const layout = getGlobeLayout(-100, 25);
            const config = getGlobeConfig();

            Plotly.newPlot('globe', [cvnTrace, amphibTrace], layout, config);

            document.getElementById('globe').on('plotly_click', function(data) {
                if (data.points && data.points.length > 0) {
                    const ship = data.points[0].customdata;
                    if (ship) { showFleetDetail(ship); highlightFleetCard(ship.hull); }
                }
            });
        }

        function getGlobeLayout(lon = -100, lat = 25) {
            return {
                geo: {
                    projection: { type: 'orthographic', rotation: { lon: lon, lat: lat } },
                    showland: true, landcolor: '#1a1a2e', showocean: true, oceancolor: '#0a0a0f',
                    showlakes: false, showrivers: false, showcountries: true, countrycolor: '#2a2a4e', countrywidth: 0.5,
                    showcoastlines: true, coastlinecolor: '#00ff88', coastlinewidth: 0.8, showframe: false, bgcolor: 'rgba(0,0,0,0)',
                    lonaxis: { showgrid: true, gridcolor: 'rgba(0, 255, 136, 0.08)', gridwidth: 0.5 },
                    lataxis: { showgrid: true, gridcolor: 'rgba(0, 255, 136, 0.08)', gridwidth: 0.5 }
                },
                paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', margin: { t: 0, b: 0, l: 0, r: 0 },
                showlegend: true, legend: { x: 0.02, y: 0.98, bgcolor: 'rgba(10, 10, 15, 0.9)', bordercolor: '#1e1e2e', borderwidth: 1, font: { family: 'Inter, sans-serif', size: 11, color: '#888' } },
                dragmode: 'pan'
            };
        }

        function getGlobeConfig() {
            return { responsive: true, displayModeBar: true, modeBarButtonsToRemove: ['toImage', 'sendDataToCloud'], displaylogo: false, scrollZoom: true };
        }

        function renderFleetList() {
            const container = document.getElementById('shipList');
            const filtered = fleetFilter === 'all' ? shipsData : shipsData.filter(s => s.ship_type === fleetFilter);
            const grouped = {};
            filtered.forEach(ship => { if (!grouped[ship.location]) grouped[ship.location] = []; grouped[ship.location].push(ship); });
            const sortedLocations = Object.keys(grouped).sort((a, b) => grouped[b].length - grouped[a].length);

            let html = '';
            sortedLocations.forEach(location => {
                const ships = grouped[location];
                const count = ships.length;
                html += `<div class="location-group"><div class="location-header" onclick="rotateFleetTo('${location}')"><span class="location-name">${location}</span><span class="location-count">${count} ship${count > 1 ? 's' : ''}</span></div>`;
                ships.forEach(ship => {
                    const typeClass = ship.ship_type === 'CVN' ? 'cvn' : 'amphib';
                    html += `<div class="ship-card ${typeClass}" data-hull="${ship.hull}" onclick="selectFleetShip('${ship.hull}')"><div class="ship-header"><span class="ship-hull ${typeClass}">${ship.hull}</span><span class="ship-type">${ship.ship_type}</span></div><div class="ship-name">${ship.name}</div><div class="ship-date">As of ${ship.date}</div></div>`;
                });
                html += '</div>';
            });
            container.innerHTML = html;
        }

        function initFleetFilters() {
            document.querySelectorAll('#fleetFilters .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('#fleetFilters .filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    fleetFilter = this.dataset.filter;
                    renderFleetList();
                });
            });
        }

        function rotateFleetTo(location) {
            const ship = shipsData.find(s => s.location === location);
            if (ship) Plotly.relayout('globe', { 'geo.projection.rotation.lon': ship.lon, 'geo.projection.rotation.lat': Math.max(-60, Math.min(60, ship.lat)) });
        }

        function selectFleetShip(hull) {
            const ship = shipsData.find(s => s.hull === hull);
            if (ship) {
                showFleetDetail(ship);
                highlightFleetCard(hull);
                Plotly.relayout('globe', { 'geo.projection.rotation.lon': ship.lon, 'geo.projection.rotation.lat': Math.max(-60, Math.min(60, ship.lat)) });
            }
        }

        function highlightFleetCard(hull) {
            document.querySelectorAll('#shipList .ship-card').forEach(card => card.classList.remove('active'));
            const card = document.querySelector(`#shipList .ship-card[data-hull="${hull}"]`);
            if (card) { card.classList.add('active'); card.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
        }

        function showFleetDetail(ship) {
            selectedFleetShip = ship;
            document.getElementById('fleetDetailPanel').classList.remove('hidden');
            document.getElementById('fleetDetailTitle').textContent = `${ship.hull} - ${ship.name}`;
            document.getElementById('fleetDetailClass').textContent = `${ship.ship_class}-class ${ship.ship_type}`;
            document.getElementById('fleetDetailLocation').textContent = ship.location;
            document.getElementById('fleetDetailRegion').textContent = ship.region;
            document.getElementById('fleetDetailDate').textContent = ship.date;
            document.getElementById('fleetDetailStatus').textContent = ship.status;
        }

        function closeFleetDetail() {
            document.getElementById('fleetDetailPanel').classList.add('hidden');
            document.querySelectorAll('#shipList .ship-card').forEach(card => card.classList.remove('active'));
            selectedFleetShip = null;
        }

        // ============================================================================
        // CARRIER MODAL
        // ============================================================================

        function showCarrierModal() {
            const carriers = shipsData.filter(s => s.ship_type === 'CVN').sort((a, b) => {
                const numA = parseInt(a.hull.replace('CVN', ''));
                const numB = parseInt(b.hull.replace('CVN', ''));
                return numA - numB;
            });
            const grid = document.getElementById('carrierGrid');
            grid.innerHTML = carriers.map(c => `
                <div class="carrier-item" onclick="selectCarrierFromModal('${c.hull}')">
                    <div class="carrier-hull">${c.hull}</div>
                    <div class="carrier-name">${c.name}</div>
                    <div class="carrier-location">${c.location}</div>
                </div>
            `).join('');
            document.getElementById('carrierModal').classList.add('visible');
            document.body.style.overflow = 'hidden';
        }

        function closeCarrierModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('carrierModal').classList.remove('visible');
            document.body.style.overflow = '';
        }

        function selectCarrierFromModal(hull) {
            closeCarrierModal();
            switchTab('fleet');
            selectFleetShip(hull);
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeCarrierModal();
        });

        // ============================================================================
        // DVIDS AGGREGATOR (Card Grid Layout)
        // ============================================================================

        async function loadDvidsData() {
            let loaded = false;

            try {
                // Try to load from local file first
                const response = await fetch('dvids_data.json');
                if (response.ok) {
                    dvidsData = await response.json();
                    console.log('Loaded DVIDS data:', dvidsData.total_count, 'items');
                    loaded = true;

                    // Update timestamp if available from data
                    if (dvidsData.timestamp) {
                        const el = document.getElementById('lastUpdateDvids');
                        if (el) el.textContent = dvidsData.timestamp.slice(0, 16).replace('T', ' ') + ' UTC';
                    }
                }
            } catch (error) {
                console.log('DVIDS data not available locally');
            }

            if (!loaded) {
                console.log('Trying GitHub Pages for DVIDS data...');
                try {
                    const ghResponse = await fetch('https://ianellisjones.github.io/usn/dvids_data.json');
                    if (ghResponse.ok) {
                        dvidsData = await ghResponse.json();
                        console.log('Loaded DVIDS data from GitHub:', dvidsData.total_count, 'items');
                        loaded = true;

                        if (dvidsData.timestamp) {
                            const el = document.getElementById('lastUpdateDvids');
                            if (el) el.textContent = dvidsData.timestamp.slice(0, 16).replace('T', ' ') + ' UTC';
                        }
                    }
                } catch (e) {
                    console.log('Could not load DVIDS data from GitHub either');
                }
            }

            initDvidsSection();
            // Update status bar if on DVIDS tab
            if (activeTab === 'dvids') {
                updateStatusBar('dvids');
            }
        }

        function initDvidsSection() {
            initDvidsFilters();
            initDvidsSearch();
            initDvidsPeriodToggle();
            updateDvidsStats();
            renderDvidsGrid();
        }

        function initDvidsFilters() {
            document.querySelectorAll('#dvidsFilters .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('#dvidsFilters .filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    dvidsFilter = this.dataset.filter;
                    renderDvidsGrid();
                });
            });
        }

        function initDvidsSearch() {
            document.getElementById('dvidsSearch').addEventListener('input', function(e) {
                dvidsSearch = e.target.value.toLowerCase();
                renderDvidsGrid();
            });
        }

        function initDvidsPeriodToggle() {
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    dvidsPeriod = this.dataset.period;
                    renderDvidsGrid();
                });
            });
        }

        function updateDvidsStats() {
            const items = dvidsData.items || [];
            const types = dvidsData.by_type || {};

            document.getElementById('dvidsTotalCount').textContent = items.length;
            document.getElementById('dvidsNewsCount').textContent = types.news || 0;
            document.getElementById('dvidsImageCount').textContent = types.image || 0;
            document.getElementById('dvidsVideoCount').textContent = types.video || 0;
        }

        function renderDvidsGrid() {
            const container = document.getElementById('dvidsGrid');
            let items = dvidsData.items || [];

            // Filter by period (24h vs 7 days)
            if (dvidsPeriod === 'daily') {
                items = items.filter(i => (i.hours_old || 0) <= 24);
            }

            // Filter by type
            if (dvidsFilter !== 'all') {
                items = items.filter(i => i.type === dvidsFilter);
            }

            // Filter by search
            if (dvidsSearch) {
                items = items.filter(i =>
                    (i.title || '').toLowerCase().includes(dvidsSearch) ||
                    (i.unit_name || '').toLowerCase().includes(dvidsSearch) ||
                    (i.description || '').toLowerCase().includes(dvidsSearch) ||
                    (i.country || '').toLowerCase().includes(dvidsSearch) ||
                    (i.branch || '').toLowerCase().includes(dvidsSearch)
                );
            }

            let html = '';

            if (items.length === 0) {
                html = `
                    <div class="dvids-empty">
                        <div class="dvids-empty-icon">&#128240;</div>
                        <div class="dvids-empty-title">No DVIDS content found</div>
                        <div class="dvids-empty-text">Try adjusting your filters or search terms.<br>Run the GEOINT scraper to fetch the latest content.</div>
                    </div>
                `;
            } else {
                items.forEach(item => {
                    const thumbUrl = item.thumbnail_url || '';
                    const title = item.title || 'Untitled';
                    const desc = item.description || '';
                    const type = item.type || 'news';
                    const branch = item.branch || '';
                    const country = item.country || '';
                    const unit = item.unit_name || '';
                    const date = item.date_published || '';
                    const url = item.url || '#';

                    html += `
                        <div class="dvids-grid-card ${type}" onclick="window.open('${url}', '_blank')">
                            ${thumbUrl ? `<img class="dvids-grid-thumb" src="${thumbUrl}" alt="" onerror="this.style.display='none'">` : '<div class="dvids-grid-thumb"></div>'}
                            <div class="dvids-grid-body">
                                <div class="dvids-grid-badges">
                                    <span class="dvids-grid-badge ${type}">${type}</span>
                                    ${branch ? `<span class="dvids-grid-badge branch">${branch}</span>` : ''}
                                    ${country ? `<span class="dvids-grid-badge location">${country}</span>` : ''}
                                </div>
                                <div class="dvids-grid-title">${title}</div>
                                <div class="dvids-grid-desc">${desc}</div>
                                <div class="dvids-grid-footer">
                                    <span class="dvids-grid-unit">${unit}</span>
                                    <span class="dvids-grid-date">${date}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            container.innerHTML = html;
        }

        // ============================================================================
        // BREAKING NEWS
        // ============================================================================

        let newsGlobeInitialized = false;

        async function loadNewsData() {
            let loaded = false;

            try {
                // Try to load news data from local file
                const response = await fetch('news_data.json');
                if (response.ok) {
                    newsData = await response.json();
                    console.log('Loaded news data from local file');
                    loaded = true;
                }
            } catch (error) {
                console.log('News data not available locally');
            }

            if (!loaded) {
                console.log('Trying GitHub Pages for news data...');
                try {
                    const ghResponse = await fetch('https://ianellisjones.github.io/usn/news_data.json');
                    if (ghResponse.ok) {
                        newsData = await ghResponse.json();
                        console.log('Loaded news data from GitHub');
                        loaded = true;
                    }
                } catch (e) {
                    console.log('Could not load news data from GitHub');
                }
            }

            // Use sample headlines if no data loaded
            if (!loaded) {
                console.log('Using sample headlines');
                newsData = {
                    categories: {
                        globe: [
                            { title: "Global tensions rise as trade negotiations stall", source: "Reuters", url: "#", breaking: true },
                            { title: "UN Security Council convenes emergency session", source: "AP News", url: "#" },
                            { title: "International climate summit reaches breakthrough agreement", source: "BBC World", url: "#" }
                        ],
                        us: [
                            { title: "Pentagon announces new defense strategy priorities", source: "Defense News", url: "#", breaking: true },
                            { title: "Navy expands Pacific presence amid regional tensions", source: "Navy Times", url: "#", high: true },
                            { title: "Congress debates new military funding bill", source: "The Hill", url: "#" }
                        ],
                        europe: [
                            { title: "NATO allies increase defense spending commitments", source: "Stars & Stripes", url: "#" },
                            { title: "European nations strengthen eastern border security", source: "Politico EU", url: "#" }
                        ],
                        asia: [
                            { title: "Indo-Pacific Command conducts multilateral exercises", source: "PACOM", url: "#", high: true },
                            { title: "South China Sea tensions escalate following incident", source: "SCMP", url: "#" },
                            { title: "Japan announces defense modernization plans", source: "Nikkei", url: "#" }
                        ],
                        mideast: [
                            { title: "Fifth Fleet maintains presence in Arabian Gulf", source: "NAVCENT", url: "#" },
                            { title: "Regional powers engage in diplomatic talks", source: "Al Jazeera", url: "#" }
                        ],
                        conflicts: [
                            { title: "Humanitarian crisis worsens in conflict zone", source: "UN News", url: "#", breaking: true },
                            { title: "Peacekeeping forces deploy to volatile region", source: "Reuters", url: "#" }
                        ],
                        cyber: [
                            { title: "Major cyber attack targets critical infrastructure", source: "CyberScoop", url: "#", breaking: true },
                            { title: "Defense agencies enhance cybersecurity protocols", source: "FCW", url: "#" }
                        ],
                        finance: [
                            { title: "Defense stocks surge on new contract announcements", source: "Bloomberg", url: "#" },
                            { title: "Military budget allocation shifts priorities", source: "Defense One", url: "#" }
                        ]
                    }
                };
            }

            initNewsSection();
            if (activeTab === 'news') {
                updateStatusBar('news');
            }
        }

        function initNewsSection() {
            initNewsFilters();
            renderNewsList();
        }

        function initNewsGlobe() {
            if (newsGlobeInitialized) return;
            newsGlobeInitialized = true;

            // Create a simple globe for news visualization with region markers
            const regions = [
                { name: 'US', lat: 39.8, lon: -98.5, count: newsData.categories.us?.length || 0 },
                { name: 'Europe', lat: 50, lon: 10, count: newsData.categories.europe?.length || 0 },
                { name: 'Asia', lat: 35, lon: 105, count: newsData.categories.asia?.length || 0 },
                { name: 'Middle East', lat: 29, lon: 47, count: newsData.categories.mideast?.length || 0 },
                { name: 'Global', lat: 20, lon: -30, count: newsData.categories.globe?.length || 0 }
            ];

            const trace = {
                type: 'scattergeo', mode: 'markers+text',
                lat: regions.map(r => r.lat),
                lon: regions.map(r => r.lon),
                text: regions.map(r => r.name),
                textposition: 'top center',
                textfont: { family: 'Inter, sans-serif', size: 11, color: '#58a6ff' },
                hoverinfo: 'text',
                hovertext: regions.map(r => `<b>${r.name}</b><br>${r.count} headlines`),
                marker: {
                    size: regions.map(r => Math.max(12, Math.min(35, 10 + r.count * 3))),
                    color: '#58a6ff',
                    opacity: 0.7,
                    line: { width: 2, color: '#3d8bfd' }
                },
                name: 'News Regions'
            };

            const layout = getGlobeLayout(0, 20);
            const config = getGlobeConfig();

            Plotly.newPlot('newsGlobe', [trace], layout, config);
        }

        function initNewsFilters() {
            document.querySelectorAll('#newsFilters .filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('#newsFilters .filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    newsFilter = this.dataset.filter;
                    renderNewsList();
                });
            });
        }

        function renderNewsList() {
            const container = document.getElementById('newsList');
            let html = '';

            const categories = {
                globe: { name: 'GLOBE', items: newsData.categories.globe || [] },
                us: { name: 'UNITED STATES', items: newsData.categories.us || [] },
                europe: { name: 'EUROPE', items: newsData.categories.europe || [] },
                asia: { name: 'ASIA', items: newsData.categories.asia || [] },
                mideast: { name: 'MIDDLE EAST', items: newsData.categories.mideast || [] },
                conflicts: { name: 'CONFLICTS', items: newsData.categories.conflicts || [] },
                cyber: { name: 'CYBERSECURITY', items: newsData.categories.cyber || [] },
                finance: { name: 'FINANCE', items: newsData.categories.finance || [] }
            };

            // Filter categories based on selection
            let categoriesToShow;
            if (newsFilter === 'all') {
                categoriesToShow = Object.entries(categories);
            } else if (newsFilter === 'breaking') {
                // Show all categories but only breaking items
                categoriesToShow = Object.entries(categories).map(([key, cat]) => [
                    key, { ...cat, items: cat.items.filter(i => i.breaking) }
                ]).filter(([_, cat]) => cat.items.length > 0);
            } else {
                categoriesToShow = [[newsFilter, categories[newsFilter]]].filter(([_, cat]) => cat);
            }

            if (categoriesToShow.length === 0 || categoriesToShow.every(([_, cat]) => cat.items.length === 0)) {
                html = `<div style="padding: 40px 20px; text-align: center; color: #555;">
                    <div style="font-size: 14px; margin-bottom: 10px;">No headlines available</div>
                    <div style="font-size: 11px;">Run the news aggregator notebook to populate headlines</div>
                </div>`;
            } else {
                categoriesToShow.forEach(([key, cat]) => {
                    if (cat.items.length > 0) {
                        html += `<div class="news-section">
                            <div class="news-section-header">${cat.name}</div>`;

                        cat.items.forEach(item => {
                            const priorityClass = item.breaking ? 'breaking' : (item.high ? 'high' : '');
                            html += `<div class="news-item ${priorityClass}" onclick="openNewsLink('${item.url || '#'}')">
                                <div class="news-headline">${item.title || 'Untitled'}</div>
                                <div class="news-source">${item.source || ''}</div>
                            </div>`;
                        });

                        html += '</div>';
                    }
                });
            }

            container.innerHTML = html;
        }

        function openNewsLink(url) {
            if (url && url !== '#') {
                window.open(url, '_blank');
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>U.S. NAVY FLEET TRACKER</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { background: #0a0a0f; color: #e0e0e0; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; min-height: 100vh; overflow-x: hidden; }
        .header { background: linear-gradient(180deg, #111118 0%, #0a0a0f 100%); border-bottom: 1px solid #1e1e2e; padding: 12px 16px; position: sticky; top: 0; z-index: 100; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .logo { font-size: 14px; font-weight: 700; color: #00ff88; letter-spacing: 0.5px; }
        .logo-sub { font-size: 9px; font-weight: 500; color: #666; letter-spacing: 1px; margin-top: 2px; text-transform: uppercase; }
        .timestamp { font-size: 9px; color: #444; font-weight: 500; text-align: right; }
        .timestamp span { color: #00ff88; }
        .stats-row { display: flex; justify-content: space-around; gap: 8px; }
        .stat { text-align: center; flex: 1; padding: 8px 4px; background: rgba(255,255,255,0.02); border-radius: 8px; }
        .stat-value { font-size: 24px; font-weight: 700; color: #00ffff; }
        .stat-value.cvn { color: #ff6b6b; }
        .stat-value.amphib { color: #4ecdc4; }
        .stat-label { font-size: 8px; font-weight: 600; color: #555; letter-spacing: 1px; text-transform: uppercase; margin-top: 2px; }
        .globe-section { width: 100%; height: 45vh; min-height: 280px; max-height: 400px; background: #0a0a0f; position: relative; }
        #globe { width: 100%; height: 100%; }
        .carrier-btn-container { padding: 12px 16px; background: #0a0a0f; }
        .carrier-btn { font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 600; padding: 14px 20px; background: linear-gradient(135deg, #ff6b6b 0%, #cc4444 100%); border: none; color: #fff; cursor: pointer; border-radius: 10px; width: 100%; box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3); letter-spacing: 0.5px; }
        .carrier-btn:active { transform: scale(0.98); }
        .filter-bar { padding: 12px 16px; background: #0d0d14; border-top: 1px solid #1e1e2e; display: flex; gap: 8px; overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .filter-btn { font-family: 'Inter', sans-serif; font-size: 12px; font-weight: 600; padding: 10px 18px; background: transparent; border: 1px solid #2a2a3a; color: #666; cursor: pointer; border-radius: 8px; white-space: nowrap; flex-shrink: 0; }
        .filter-btn.active { background: rgba(0, 255, 136, 0.1); border-color: #00ff88; color: #00ff88; }
        .ship-list { padding: 12px 16px 100px; }
        .location-group { margin-bottom: 16px; }
        .location-header { display: flex; align-items: center; gap: 8px; padding: 12px 14px; background: rgba(0, 255, 136, 0.05); border-radius: 10px; margin-bottom: 10px; }
        .location-name { flex: 1; font-size: 13px; font-weight: 600; color: #00ff88; }
        .location-count { font-size: 11px; font-weight: 600; color: #888; background: rgba(255,255,255,0.05); padding: 4px 10px; border-radius: 12px; }
        .ship-card { background: rgba(255, 255, 255, 0.02); border: 1px solid #1e1e2e; border-radius: 10px; margin-bottom: 8px; margin-left: 8px; padding: 14px 16px; }
        .ship-card.active { border-color: #00ffff; background: rgba(0, 255, 255, 0.08); }
        .ship-card.cvn { border-left: 4px solid #ff6b6b; }
        .ship-card.amphib { border-left: 4px solid #4ecdc4; }
        .ship-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
        .ship-hull { font-size: 16px; font-weight: 700; color: #fff; }
        .ship-hull.cvn { color: #ff6b6b; }
        .ship-hull.amphib { color: #4ecdc4; }
        .ship-type { font-size: 10px; font-weight: 600; padding: 4px 10px; border-radius: 6px; background: rgba(255, 255, 255, 0.06); color: #888; }
        .ship-name { font-size: 13px; color: #777; font-weight: 500; }
        .ship-date { font-size: 11px; color: #444; margin-top: 4px; font-weight: 500; }
        .detail-panel { position: fixed; bottom: 0; left: 0; right: 0; background: #111118; border-top: 1px solid #2a2a3a; padding: 16px; transform: translateY(100%); transition: transform 0.3s ease; z-index: 200; max-height: 50vh; overflow-y: auto; border-radius: 20px 20px 0 0; }
        .detail-panel.visible { transform: translateY(0); }
        .detail-handle { width: 40px; height: 4px; background: #333; border-radius: 2px; margin: 0 auto 12px; }
        .detail-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 14px; }
        .detail-title { font-size: 16px; font-weight: 700; color: #00ffff; }
        .detail-close { cursor: pointer; color: #555; font-size: 28px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; border-radius: 8px; }
        .detail-row { display: flex; margin-bottom: 10px; }
        .detail-label { width: 80px; font-size: 11px; font-weight: 600; color: #444; text-transform: uppercase; }
        .detail-value { flex: 1; font-size: 14px; color: #aaa; font-weight: 500; }
        .detail-status { font-size: 13px; color: #00ff88; line-height: 1.6; padding: 14px; background: rgba(0, 0, 0, 0.3); border-radius: 10px; margin-top: 12px; }
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.9); display: flex; align-items: flex-end; justify-content: center; z-index: 300; opacity: 0; visibility: hidden; transition: all 0.3s ease; }
        .modal-overlay.visible { opacity: 1; visibility: visible; }
        .modal { background: #111118; border-radius: 20px 20px 0 0; width: 100%; max-height: 85vh; overflow: hidden; transform: translateY(100%); transition: transform 0.3s ease; }
        .modal-overlay.visible .modal { transform: translateY(0); }
        .modal-header { padding: 16px 20px; border-bottom: 1px solid #1e1e2e; }
        .modal-handle { width: 40px; height: 4px; background: #333; border-radius: 2px; margin: 0 auto 12px; }
        .modal-title { font-size: 16px; font-weight: 700; color: #ff6b6b; text-align: center; }
        .modal-subtitle { font-size: 10px; color: #666; margin-top: 4px; text-align: center; }
        .modal-body { padding: 16px; overflow-y: auto; max-height: calc(85vh - 80px); }
        .carrier-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .carrier-item { background: rgba(255, 107, 107, 0.05); border: 1px solid rgba(255, 107, 107, 0.2); border-radius: 12px; padding: 14px; }
        .carrier-item:active { background: rgba(255, 107, 107, 0.15); }
        .carrier-hull { font-size: 15px; font-weight: 700; color: #ff6b6b; margin-bottom: 2px; }
        .carrier-name { font-size: 11px; color: #888; font-weight: 500; margin-bottom: 8px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .carrier-location { font-size: 10px; color: #00ff88; font-weight: 600; padding: 4px 8px; background: rgba(0, 255, 136, 0.1); border-radius: 4px; display: inline-block; }
        .attribution { padding: 16px; text-align: center; font-size: 10px; color: #444; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <div>
                <div class="logo">U.S. NAVY FLEET TRACKER</div>
                <div class="logo-sub">Carrier &amp; Amphibious Operations</div>
            </div>
            <div class="timestamp">Updated<br><span>2026-02-17 06:56 UTC</span></div>
        </div>
        <div class="stats-row">
            <div class="stat">
                <div class="stat-value">20</div>
                <div class="stat-label">Total</div>
            </div>
            <div class="stat">
                <div class="stat-value cvn">11</div>
                <div class="stat-label">Carriers</div>
            </div>
            <div class="stat">
                <div class="stat-value amphib">9</div>
                <div class="stat-label">Amphibs</div>
            </div>
        </div>
    </header>

    <div class="globe-section">
        <div id="globe"></div>
    </div>

    <div class="carrier-btn-container">
        <button class="carrier-btn" onclick="showCarrierModal()">Where are the carriers?</button>
    </div>

    <div class="filter-bar">
        <button class="filter-btn active" data-filter="all">All Ships</button>
        <button class="filter-btn" data-filter="CVN">Carriers</button>
        <button class="filter-btn" data-filter="LHA">LHA</button>
        <button class="filter-btn" data-filter="LHD">LHD</button>
    </div>

    <div class="ship-list" id="shipList"></div>

    <div class="detail-panel" id="detailPanel">
        <div class="detail-handle"></div>
        <div class="detail-header">
            <div class="detail-title" id="detailTitle">-</div>
            <span class="detail-close" onclick="closeDetail()">&#x2715;</span>
        </div>
        <div class="detail-row">
            <div class="detail-label">Class</div>
            <div class="detail-value" id="detailClass">-</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">Location</div>
            <div class="detail-value" id="detailLocation">-</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">Region</div>
            <div class="detail-value" id="detailRegion">-</div>
        </div>
        <div class="detail-row">
            <div class="detail-label">As Of</div>
            <div class="detail-value" id="detailDate">-</div>
        </div>
        <div class="detail-status" id="detailStatus">-</div>
    </div>

    <div class="attribution">Created by @ianellisjones and IEJ Media</div>

    <div class="modal-overlay" id="carrierModal" onclick="closeCarrierModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-handle"></div>
                <div class="modal-title">WHERE ARE THE CARRIERS?</div>
                <div class="modal-subtitle">All 11 U.S. Navy aircraft carriers</div>
            </div>
            <div class="modal-body">
                <div class="carrier-grid" id="carrierGrid"></div>
            </div>
        </div>
    </div>

    <script>
        const shipsData = [{"hull": "CVN68", "name": "USS Nimitz", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Bremerton / Kitsap", "lat": 47.5673, "lon": -122.6329, "region": "CONUS", "date": "2025", "status": ", USS Nimitz  moored at Delta Pier on Naval Base Kitsap-Bremerton following an extended nine-month deployment in the U.S. 5th and 7th Fleet AoR.", "source_url": "http://uscarriers.net/cvn68history.htm", "display_lat": 47.5673, "display_lon": -119.6329}, {"hull": "CVN69", "name": "USS Dwight D. Eisenhower", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "Jan. 8", "status": "September 26, USS Dwight D. Eisenhower moored at Pier 12N on Naval Station Norfolk after a six-day underway for TRACOM-CQ, in the Jacksonville Op. Area; Moved \"dead-stick\" to Super Pier 5N in Norfolk Naval Shipyard, for a Planned Incremental Availability (PIA), on Jan. 8.", "source_url": "http://uscarriers.net/cvn69history.htm", "display_lat": 36.9473, "display_lon": -71.3134}, {"hull": "CVN70", "name": "USS Carl Vinson", "ship_class": "Nimitz", "ship_type": "CVN", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "September 16", "status": "September 16, The Carl Vinson moored at Juliet Pier on Naval Air Station North Island after a three-day underway for ammo offload.", "source_url": "http://uscarriers.net/cvn70history.htm", "display_lat": 32.7157, "display_lon": -112.1611}, {"hull": "CVN71", "name": "USS Theodore Roosevelt", "ship_class": "Nimitz", "ship_type": "CVN", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "February 9", "status": "February 9, USS Theodore Roosevelt moored at Berth Lima on Naval Air Station North Island.", "source_url": "http://uscarriers.net/cvn71history.htm", "display_lat": 37.69534607176052, "display_lon": -114.2861}, {"hull": "CVN72", "name": "USS Abraham Lincoln", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Arabian Sea", "lat": 15.0, "lon": 65.0, "region": "CENTCOM", "date": "February 6", "status": "February 6, The Abraham Lincoln participated in a PHOTOEX with the USS Michael Murphy (DDG 112), USS Frank E. Petersen, Jr., (DDG 121), USNS Carl Brashear, USNS Henry J. Kaiser, USCGC Robert Goldman (WPC 1142) and USCGC Clarence Sutphin, Jr., (WPC 1147), while underway in the North Arabian Sea.", "source_url": "http://uscarriers.net/cvn72history.htm", "display_lat": 15.0, "display_lon": 65.0}, {"hull": "CVN73", "name": "USS George Washington", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Yokosuka", "lat": 35.2831, "lon": 139.6703, "region": "WESTPAC", "date": "2025", "status": ", USS George Washington moored at Berth 12 on Fleet Activities Yokosuka following a two-month patrol.", "source_url": "http://uscarriers.net/cvn73history.htm", "display_lat": 35.2831, "display_lon": 139.6703}, {"hull": "CVN74", "name": "USS John C. Stennis", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Newport News", "lat": 36.9788, "lon": -76.428, "region": "CONUS", "date": "April 8", "status": "April 8, 2024 USS John C. Stennis undocked and moored at Outfitting Berth #1 on Newport News Shipyard.", "source_url": "http://uscarriers.net/cvn74history.htm", "display_lat": 36.9788, "display_lon": -76.428}, {"hull": "CVN75", "name": "USS Harry S. Truman", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "Jan. 21", "status": "September 26, The Harry S. Truman moored at Pier 14S on Naval Station Norfolk; Moved to Pier 14N on Sept. 28; Brief underway  on Oct. 8; Moved to Pier 12N on Jan. 21, 2026.", "source_url": "http://uscarriers.net/cvn75history.htm", "display_lat": 41.92694607176052, "display_lon": -73.4384}, {"hull": "CVN76", "name": "USS Ronald Reagan", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Bremerton / Kitsap", "lat": 47.5673, "lon": -122.6329, "region": "CONUS", "date": "Dec. 2", "status": "November 12,  USS Ronald Reagan moored at Bravo Pier on Naval Base Kitsap-Bremerton; Underway for FRS-CQ, in the SOCAL Op. Area, from Dec. 2-13.", "source_url": "http://uscarriers.net/cvn76history.htm", "display_lat": 47.5673, "display_lon": -126.08290000000001}, {"hull": "CVN77", "name": "USS George H.W. Bush", "ship_class": "Nimitz", "ship_type": "CVN", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "Feb. 3", "status": "January 27, 2026 USS George H.W. Bush moored at Pier 14S on Naval Station Norfolk after a two-week underway for FRS-CQ, in the Virginia Capes and Key West Op. Areas; Underway for  Composite Training Unit Exercise (COMPTUEX) on Feb. 3.", "source_url": "http://uscarriers.net/cvn77history.htm", "display_lat": 41.27742701892219, "display_lon": -78.8134}, {"hull": "CVN78", "name": "USS Gerald R. Ford", "ship_class": "Ford", "ship_type": "CVN", "location": "Caribbean Sea", "lat": 15.5, "lon": -73.0, "region": "SOUTHCOM", "date": "Feb. 13", "status": "January 21,  USS Gerard R. Ford anchored approx. 1 n.m. off the coast of Charlotte Amalie West, St. Thomas Island, U.S. Virgin Islands, for a five-day liberty port visit;  Conducted a replenishment-at-sea with the USNS Supply on Jan. 27 and Feb. 7; Conducted operations southwest and south of Puerto Rico from Jan. 27- Feb. 12; Transited the Anegada Passage northbound on Feb. 13.", "source_url": "http://uscarriers.net/cvn78history.htm", "display_lat": 15.5, "display_lon": -70.0}, {"hull": "LHD1", "name": "USS Wasp", "ship_class": "Wasp", "ship_type": "LHD", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "May 19", "status": "April 14, USS Wasp moored at Berth 6, Pier 11 on Naval Station Norfolk after a 10-day underway for deck landing qualifications, in the Virginia Capes Op. Area; Underway again on April 28; Moored at Berth 6, Pier 6 on May 9; Moved \"dead-stick\" to Pier 1 in BAE Systems shipyard on May 19.", "source_url": "http://uscarriers.net/lhd1history.htm", "display_lat": 36.9473, "display_lon": -82.0634}, {"hull": "LHD2", "name": "USS Essex", "ship_class": "Wasp", "ship_type": "LHD", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "Feb. 14", "status": "January 24, 2026 USS Essex moored at Berth 5, Pier 2 on Naval Base San Diego after a two-day underway in the SOCAL Op. Area; Underway again on Feb. 3; Anchored at A-173 for a day-long stop on Feb. 14 and 15th.", "source_url": "http://uscarriers.net/lhd2history.htm", "display_lat": 37.04582701892219, "display_lon": -119.6611}, {"hull": "LHD3", "name": "USS Kearsarge", "ship_class": "Wasp", "ship_type": "LHD", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "February  13", "status": "February  13, 2026 USS Kearsarge moored at Berth 4, Pier 14 on Naval Station Norfolk after a four-day underway for deck landing qualifications, in the Virginia Capes Op. Area.", "source_url": "http://uscarriers.net/lhd3history.htm", "display_lat": 32.61717298107781, "display_lon": -78.8134}, {"hull": "LHD4", "name": "USS Boxer", "ship_class": "Wasp", "ship_type": "LHD", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "February 6", "status": "February 6, 2026  USS Boxer moored at Berth 6, Pier 13 on Naval Base San Diego after a 16-day underway for ARG/MEUEX.", "source_url": "http://uscarriers.net/lhd4history.htm", "display_lat": 32.7157, "display_lon": -122.9111}, {"hull": "LHD5", "name": "USS Bataan", "ship_class": "Wasp", "ship_type": "LHD", "location": "Norfolk / Portsmouth", "lat": 36.9473, "lon": -76.3134, "region": "CONUS", "date": "2025", "status": "July ?, 2025 USS Bataan undocked and moored at  Berth 2E on NASSCO shipyard.", "source_url": "http://uscarriers.net/lhd5history.htm", "display_lat": 31.96765392823948, "display_lon": -73.4384}, {"hull": "LHD7", "name": "USS Iwo Jima", "ship_class": "Wasp", "ship_type": "LHD", "location": "Caribbean Sea", "lat": 15.5, "lon": -73.0, "region": "SOUTHCOM", "date": "Feb. 7", "status": "February 10, Lance Cpl. Chukwuemeka E. Oforah, assigned to the 3rd Battalion, 6th Marine Regiment, was declared deceased after falling overboard  in the evening of Feb. 7, while the Iwo Jima was underway in the Caribbean Sea.", "source_url": "http://uscarriers.net/lhd7history.htm", "display_lat": 15.5, "display_lon": -76.45}, {"hull": "LHD8", "name": "USS Makin Island", "ship_class": "Wasp", "ship_type": "LHD", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "Feb. 4", "status": "January 21, USS Makin Island departed Naval Base San Diego for a Quarterly Underway Amphibious Readiness Training 26.2; Anchored off Camp Pendleton from Jan. 23-24; Moored at Berth 5, Pier 8 on Jan. 30; Underway again from Feb. 4-5.", "source_url": "http://uscarriers.net/lhd8history.htm", "display_lat": 28.385572981077807, "display_lon": -119.6611}, {"hull": "LHA6", "name": "USS America", "ship_class": "America", "ship_type": "LHA", "location": "San Diego", "lat": 32.7157, "lon": -117.1611, "region": "CONUS", "date": "2027", "status": ", USS America moored at Berth 5, Pier 13 in its new homeport of Naval Base San Diego after forward-deployed to Japan for nearly six years.", "source_url": "http://uscarriers.net/lha6history.htm", "display_lat": 27.73605392823948, "display_lon": -114.2861}, {"hull": "LHA7", "name": "USS Tripoli", "ship_class": "America", "ship_type": "LHA", "location": "Okinawa", "lat": 26.3344, "lon": 127.8056, "region": "WESTPAC", "date": "Feb. 8", "status": "The Tripoli  moored at Navy Pier East on White Beach Naval Facility for a two-day port call; Moored at Navy Pier East again from Feb. 8-10.", "source_url": "http://uscarriers.net/lha7history.htm", "display_lat": 26.3344, "display_lon": 127.8056}];
        let activeFilter = 'all';
        let selectedShip = null;

        function initGlobe() {
            const cvnShips = shipsData.filter(s => s.ship_type === 'CVN');
            const amphibShips = shipsData.filter(s => s.ship_type !== 'CVN');

            const cvnTrace = {
                type: 'scattergeo', mode: 'markers+text',
                lat: cvnShips.map(s => s.display_lat), lon: cvnShips.map(s => s.display_lon),
                text: cvnShips.map(s => s.hull), textposition: 'top center',
                textfont: { family: 'Inter, sans-serif', size: 8, color: '#ff6b6b', weight: 600 },
                hoverinfo: 'text', hovertext: cvnShips.map(s => `${s.hull}: ${s.location}`),
                marker: { size: 10, color: '#ff6b6b', symbol: 'diamond', line: { width: 1, color: '#cc4444' } },
                name: 'CVN', customdata: cvnShips
            };

            const amphibTrace = {
                type: 'scattergeo', mode: 'markers+text',
                lat: amphibShips.map(s => s.display_lat), lon: amphibShips.map(s => s.display_lon),
                text: amphibShips.map(s => s.hull), textposition: 'top center',
                textfont: { family: 'Inter, sans-serif', size: 7, color: '#4ecdc4', weight: 600 },
                hoverinfo: 'text', hovertext: amphibShips.map(s => `${s.hull}: ${s.location}`),
                marker: { size: 8, color: '#4ecdc4', symbol: 'circle', line: { width: 1, color: '#2a9d8f' } },
                name: 'LHA/LHD', customdata: amphibShips
            };

            const layout = {
                geo: {
                    projection: { type: 'orthographic', rotation: { lon: -100, lat: 25 } },
                    showland: true, landcolor: '#1a1a2e', showocean: true, oceancolor: '#0a0a0f',
                    showlakes: false, showrivers: false, showcountries: true, countrycolor: '#2a2a4e', countrywidth: 0.3,
                    showcoastlines: true, coastlinecolor: '#00ff88', coastlinewidth: 0.5, showframe: false, bgcolor: 'rgba(0,0,0,0)',
                    lonaxis: { showgrid: false }, lataxis: { showgrid: false }
                },
                paper_bgcolor: 'rgba(0,0,0,0)', plot_bgcolor: 'rgba(0,0,0,0)', margin: { t: 0, b: 0, l: 0, r: 0 },
                showlegend: false, dragmode: 'pan'
            };

            const config = { responsive: true, displayModeBar: false, scrollZoom: true };
            Plotly.newPlot('globe', [cvnTrace, amphibTrace], layout, config);
            document.getElementById('globe').on('plotly_click', function(data) {
                if (data.points && data.points.length > 0) {
                    const ship = data.points[0].customdata;
                    if (ship) { showDetail(ship); highlightShipCard(ship.hull); }
                }
            });
        }

        function renderShipList() {
            const container = document.getElementById('shipList');
            const filtered = activeFilter === 'all' ? shipsData : shipsData.filter(s => s.ship_type === activeFilter);
            const grouped = {};
            filtered.forEach(ship => { if (!grouped[ship.location]) grouped[ship.location] = []; grouped[ship.location].push(ship); });
            const sortedLocations = Object.keys(grouped).sort((a, b) => grouped[b].length - grouped[a].length);
            let html = '';
            sortedLocations.forEach(location => {
                const ships = grouped[location];
                const count = ships.length;
                html += `<div class="location-group"><div class="location-header" onclick="rotateToLocation('${location}')"><span class="location-name">${location}</span><span class="location-count">${count}</span></div>`;
                ships.forEach(ship => {
                    const typeClass = ship.ship_type === 'CVN' ? 'cvn' : 'amphib';
                    html += `<div class="ship-card ${typeClass}" data-hull="${ship.hull}" onclick="selectShip('${ship.hull}')"><div class="ship-header"><span class="ship-hull ${typeClass}">${ship.hull}</span><span class="ship-type">${ship.ship_type}</span></div><div class="ship-name">${ship.name}</div><div class="ship-date">As of ${ship.date}</div></div>`;
                });
                html += '</div>';
            });
            container.innerHTML = html;
        }

        function rotateToLocation(location) {
            const ship = shipsData.find(s => s.location === location);
            if (ship) {
                Plotly.relayout('globe', { 'geo.projection.rotation.lon': ship.lon, 'geo.projection.rotation.lat': Math.max(-60, Math.min(60, ship.lat)) });
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function selectShip(hull) {
            const ship = shipsData.find(s => s.hull === hull);
            if (ship) {
                showDetail(ship);
                highlightShipCard(hull);
                Plotly.relayout('globe', { 'geo.projection.rotation.lon': ship.lon, 'geo.projection.rotation.lat': Math.max(-60, Math.min(60, ship.lat)) });
            }
        }

        function highlightShipCard(hull) {
            document.querySelectorAll('.ship-card').forEach(card => card.classList.remove('active'));
            const card = document.querySelector(`.ship-card[data-hull="${hull}"]`);
            if (card) card.classList.add('active');
        }

        function showDetail(ship) {
            selectedShip = ship;
            document.getElementById('detailPanel').classList.add('visible');
            document.getElementById('detailTitle').textContent = `${ship.hull} - ${ship.name}`;
            document.getElementById('detailClass').textContent = `${ship.ship_class}-class ${ship.ship_type}`;
            document.getElementById('detailLocation').textContent = ship.location;
            document.getElementById('detailRegion').textContent = ship.region;
            document.getElementById('detailDate').textContent = ship.date;
            document.getElementById('detailStatus').textContent = ship.status;
        }

        function closeDetail() {
            document.getElementById('detailPanel').classList.remove('visible');
            document.querySelectorAll('.ship-card').forEach(card => card.classList.remove('active'));
            selectedShip = null;
        }

        function showCarrierModal() {
            const carriers = shipsData.filter(s => s.ship_type === 'CVN').sort((a, b) => {
                const numA = parseInt(a.hull.replace('CVN', ''));
                const numB = parseInt(b.hull.replace('CVN', ''));
                return numA - numB;
            });
            const grid = document.getElementById('carrierGrid');
            grid.innerHTML = carriers.map(c => `
                <div class="carrier-item" onclick="selectCarrierFromModal('${c.hull}')">
                    <div class="carrier-hull">${c.hull}</div>
                    <div class="carrier-name">${c.name}</div>
                    <div class="carrier-location">${c.location}</div>
                </div>
            `).join('');
            document.getElementById('carrierModal').classList.add('visible');
            document.body.style.overflow = 'hidden';
        }

        function closeCarrierModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('carrierModal').classList.remove('visible');
            document.body.style.overflow = '';
        }

        function selectCarrierFromModal(hull) {
            closeCarrierModal();
            selectShip(hull);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                activeFilter = this.dataset.filter;
                renderShipList();
            });
        });

        // Swipe down to close detail panel
        let touchStartY = 0;
        document.getElementById('detailPanel').addEventListener('touchstart', e => { touchStartY = e.touches[0].clientY; });
        document.getElementById('detailPanel').addEventListener('touchmove', e => {
            if (e.touches[0].clientY - touchStartY > 50) closeDetail();
        });

        initGlobe();
        renderShipList();
    </script>
</body>
</html>